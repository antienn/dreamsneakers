<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link rel="SHORTCUT ICON" href= "./data/img/logo.png" type="image/x-icon" />
    <link rel="stylesheet" href="https://quythanh.tk/assets/css/fontawesomepro/all.css">
    <link rel="stylesheet" href="./css/index.css">
    <link rel="stylesheet" href="./css/shoe.css">
    <link rel="stylesheet" href="./css/modal.css">
    <link rel="stylesheet" href="./css/mybag.css">
    <link rel="stylesheet" href="./css/responsivehome.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>

    <!-- META FOR FACEBOOK -->
    <meta property="og:image" itemprop="thumbnailUrl" content="https://i.imgur.com/wSU9Arq.png"/>
    <meta property="og:image:width" content="1000"/>
    <meta property="og:image:height" content="500"/>
    <meta content="hệ thống bán giày lớn nhất thế giới" itemprop="headline" property="og:title"/>
</head>
<body>
    <div class="menu">
        <div class="menu_user">
            <i class="fas fa-times close"></i>
            <i class="fa-solid fa-user-large iconuser"></i>
            <div class="menu_info">
                <div class="menu_info_email">guest123@gmail.com</div>
                <div class="menu_info_name">Guest</div>
            </div>
        </div>
        <div class="menu_select">
            <ul class="menu_list_select">
                <li class="menu_list_item menu_home">
                    <i class="fa-solid fa-house"></i>
                    <p>Home</p>
                </li>
                <li class="menu_list_item menu_product">
                    <i class="fa-solid fa-gem"></i>
                    <p>Product</p>
                </li>
                <li class="menu_list_item menu_users">
                    <i class="fa-solid fa-users"></i>
                    <p>User</p>
                </li>
                <li class="menu_list_item">
                    <i class="fa-solid fa-badge-percent"></i>
                    <p>Coupon</p>
                </li>
                <li class="menu_list_item menu_login">
                    <i class="fa-solid fa-pen-to-square"></i>
                    <p>Login</p>
                </li>
                <li class="menu_list_item menu_editprofile">
                    <i class="fa-solid fa-pen-to-square"></i>
                    <p>Edit Profile</p>
                </li>
                <li class="menu_list_item menu_logout">
                    <i class="fa-solid fa-right-from-bracket"></i>
                    <p>Log out</p>
                </li>
            </ul>
        </div>
    </div>
    <div id="toast"></div>
    <div class="modal hide">
        <div class="modal__inner">
            <div class="modal__header">
                <div class="modal__title">Edit profile</div>
                <i class="fas fa-times closemodal"></i>
            </div>
            <div class="modal__body">
                <div>
                    <label for="fname">First name:</label>
                    <input autocomplete="off" autocapitalize="on" type="text" id="fname" name="fname" value="">
                </div>
                <div>
                    <label for="lname">Last name:</label>
                    <input autocomplete="off" autocapitalize="on" type="text" id="lname" name="lname" value="">
                </div>
            </div>
            <div class="modal__footer">
                <button class="modal__button-apply">Apply</button>
            </div>
        </div>
    </div>
    <div class="blackPage">
    </div>
    <div class="header">
        <i class="fa-regular fa-bars menuicon"></i>
        <div class="logo">
            <img src="./data/img/shoe.png">
        </div>
        <div class="search">
            <input autocomplete="off" type="text" id="firstname" placeholder="Search or type a command " class="search_inp">
            <i class="fa-thin fa-magnifying-glass"></i>
        </div>
        <div class="sort">
            <i class="fa-regular fa-filter"></i>
            <ul class="listsort_subnav">
                <li class="list_item_sort">Adidas</li>
                <li class="list_item_sort">Nike</li>
                <li class="list_item_sort">Puma</li>
                <li class="list_item_sort">Burberry</li>
                <li class="list_item_sort">New Balance</li>
                <li class="list_item_sort">Fila</li>
                <li class="list_item_sort">Balenciaga</li>
                <li class="list_item_sort">Under Armour</li>
            </ul>
        </div>
        <div class="mybag">
            <i class="fa-solid fa-basket-shopping"></i>
            <ul class="listbag">
            </ul>
        </div>
        <div class="user">
            <i class="fa-solid fa-user-large"></i>
            <ul class="profile__subnav ">
                <li class="profile__item editprofile">
                    <i class="fa-solid fa-pen-to-square"></i>
                    Edit profile
                </li>
                <li class="profile__item logout">
                    <i class="fa-solid fa-right-from-bracket"></i>
                    Log out
                </li>
            </ul>
        </div>
        <div class="login">
            Log in to buy 
        </div>
    </div>
    <div class="app">
        <div class="app_left">
            <ul class="list-header">
                <li class="listitem able item_home">
                    <div class="background">  
                    </div>
                    <i class="fa-solid fa-house"></i>
                    <p>Home</p>
                </li>
                <li class="listitem item_product">
                    <div class="background">  
                    </div>
                    <i class="fa-solid fa-gem"></i>
                    <p>Product</p>
                </li>
                <li class="listitem item_users">
                    <div class="background">  
                    </div>
                    <i class="fa-solid fa-users"></i>
                    <p>User</p>
                </li>
                <li class="listitem">
                    <div class="background">  
                    </div>
                    <i class="fa-solid fa-badge-percent"></i>
                    <p>Coupon</p>
                </li>

            </ul>
        </div>
        <div class="app_right">
        </div>
          
    </div>

    <script src="./data/infor/data.js"></script> 
    <script src="./js/showshoe.js"></script>  
    <script src="./js/showhome.js"></script>
    <script src="./js/showproduct.js"></script>
    <script src="./js/showuser.js"></script>
    <script src="./js/showbag.js"></script>
    <script src="./js/toast.js"></script>

    <script>
        const blockALLActive = (root) =>{
           var allActive= document.querySelectorAll('.active');
           for(let i = 0 ;i < allActive.length;i++){
                if(allActive[i]!=root){
                    allActive[i].classList.remove('active');
                }
           }
        }
        const changeAble = (root) =>{
            document.querySelector(".able").classList.remove("able")
            root.classList.add("able"); 
        }
        const returnLogin = document.querySelector(".login");
        const users = JSON.parse(localStorage.getItem("users"));
        const userSelect = document.querySelector(".user");
        const userItem = document.querySelector(".profile__subnav");
        const blackPage = document.querySelector(".blackPage");
        const lastLogin = new Date(JSON.parse(localStorage.getItem('lastlogin')));
        const timeNow = new Date();
        const curUserr = JSON.parse(localStorage.getItem('curUser'));
        if(lastLogin.getDay() == timeNow.getDay() && lastLogin.getMonth() == timeNow.getMonth() && lastLogin.getFullYear() == timeNow.getFullYear()){
            returnLogin.style.display = "none";
            document.querySelector(".menu_login").style.display="none";
            document.querySelector(".menu_info_email").innerHTML = curUserr.mail;
            document.querySelector(".menu_info_name").innerHTML = curUserr.lastName;
        }else{
            localStorage.removeItem("curUser")
            userSelect.style.display = "none"; 
            document.querySelector(".menu_editprofile").style.display="none";
            document.querySelector(".menu_logout").style.display="none";
        }

        //first
        showHome(document.querySelector(".app_right"));
        showBag(listShoe,curUserr.bagshoe,document.querySelector(".listbag"));


        returnLogin.onclick= () =>{
            window.location.href="./login.html";
            localStorage.removeItem("lastlogin");
        }
        document.querySelector(".menu_login").onclick= () =>{
            window.location.href="./login.html";
            localStorage.removeItem("lastlogin");
        }
        document.querySelector(".menu_logout").onclick= () =>{
            window.location.href="./login.html";
        }
        document.querySelector(".menu_editprofile").onclick= () =>{
            toggleModal();
            blockALLActive();
        }

        //userSelector
        userSelect.onclick = () => {
            if(!userItem.classList.contains("active")){
                blockALLActive(document.querySelector(".profile__subnav"));
                userItem.classList.add("active");
                blackPage.classList.add("active");
            }else{
                userItem.classList.remove("active");
                blackPage.classList.remove("active");
            }
        }
        blackPage.onclick =() =>{
            blockALLActive();
        }
        userItem.onclick = function (e){
            if(e.target.closest(".logout")){
                window.location.href="./login.html";
                localStorage.removeItem("lastlogin");
            }
            //edit profile
            if(e.target.closest(".editprofile")){
                toggleModal();
            }
        }
        //editprofile
        const toggleModal = () => {
            document.querySelector('.modal').classList.toggle('hide');
        }

        document.querySelector('.closemodal').addEventListener('click', () => toggleModal())
        document.querySelector('.modal').addEventListener('click', e => e.target == e.currentTarget ? toggleModal() : e.preventDefault())
        if(curUserr){
            document.querySelector('#fname').value = curUserr.firstName;
            document.querySelector('#lname').value = curUserr.lastName;
        }
        // save
        document.querySelector('.modal__button-apply').onclick = () =>{
            if(document.querySelector('#fname').value && document.querySelector('#lname').value){
                curUserr.firstName = document.querySelector('#fname').value.trim();
                curUserr.lastName = document.querySelector('#lname').value.trim();
                if(curUserr){
                    toggleModal();
                    for(let i = 0 ; i < users.length;i++){
                        if(curUserr.mail == users[i].mail){
                            users[i].firstName = document.querySelector('#fname').value.trim();
                            users[i].lastName = document.querySelector('#lname').value.trim();
                            document.querySelector(".menu_info_name").innerHTML = document.querySelector('#lname').value.trim();
                        }
                    }
                    localStorage.setItem("users", JSON.stringify(users));
                }
            }
        }

        const itemLeft = document.querySelectorAll(".listitem");
        itemLeft.forEach(c => c.addEventListener('click', () => {
            itemLeft.forEach(element => element.classList.remove('able'));
            c.classList.add("able");
        }))
        //sortShowtoPageProduct
        document.querySelector('.sort').onclick = () =>{
            if(!document.querySelector('.listsort_subnav').classList.contains('active')){
                blockALLActive();
                blackPage.classList.toggle('active');
                document.querySelector('.listsort_subnav').classList.add('active');
            }else{
                document.querySelector('.listsort_subnav').classList.remove('active');
                blockALLActive();
            }
        }

        var sortShoePage = document.querySelectorAll('.list_item_sort');
        for (let i = 0; i < sortShoePage.length; i++) {
            sortShoePage[i].onclick = function (e){
                showProduct(document.querySelector(".app_right"),e.target.innerHTML);
                changeAble(document.querySelector(".item_product"));
            }
        }

        //togglebag
        document.querySelector('.mybag').onclick = () =>{
            if(!document.querySelector('.listbag').classList.contains('active')){
                blockALLActive();
                blackPage.classList.toggle("active");
                document.querySelector('.listbag').classList.toggle('active');
            }
        }

        


        //togglemenu 
        document.querySelector('.menuicon').onclick =()=>{
            blockALLActive();
            if(!document.querySelector('.menu').classList.contains('active')){
                blackPage.classList.add("active");
                document.querySelector('.menu').classList.add('active');
            }
        }
        document.querySelector('.close').onclick =()=>{
            blackPage.classList.remove("active");
            document.querySelector('.menu').classList.remove('active');
        }
        

        //change tab
        document.querySelector(".item_product").onclick = () =>{
            showProduct(document.querySelector(".app_right"));
        }
        document.querySelector(".item_home").onclick = () =>{
            showHome(document.querySelector(".app_right"));
        }
        document.querySelector(".item_users").onclick = () =>{
            showUser(document.querySelector(".app_right"));
        }
        document.querySelector(".menu_home").onclick = () =>{
            showHome(document.querySelector(".app_right"));
            blockALLActive();
            changeAble(document.querySelector(".item_home"));
        }
        document.querySelector(".menu_product").onclick = () =>{
            showProduct(document.querySelector(".app_right"));
            blockALLActive();
            changeAble(document.querySelector(".item_product"));
        }
        document.querySelector(".menu_users").onclick = () =>{
            showUser(document.querySelector(".app_right"));
            blockALLActive();
            changeAble(document.querySelector(".item_users"));
        }
    </script>
</body>
</html>